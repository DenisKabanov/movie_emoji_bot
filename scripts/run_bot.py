#===============================================================================
# —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–∞
#===============================================================================

import numpy as np # –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏
import random # –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
import time # –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º
import json # –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤
import re # —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º
import os # –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞)
import telebot # –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º
from telebot import apihelper, types # –¥–ª—è –ø—Ä–æ–∫—Å–∏ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
from dotenv import load_dotenv # –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
from settings import * # –∏–º–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

# apihelper.proxy = { 'https': '165.22.189.59:999'} # –ø—Ä–æ–∫—Å–∏

load_dotenv() # –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
token = os.getenv('TOKEN') # –±–µ—Ä—ë–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
bot = telebot.TeleBot(token) # API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º

with open(DATA_DIR + DATA_FILE, 'r') as f: # –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è ('r')
    movies = json.load(f) # –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–∞—Ö

weights = {} # —Å–ª–æ–≤–∞—Ä—å —Å –≤–µ—Å–∞–º–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
chosen_movie = {} # —Å–ª–æ–≤–∞—Ä—å —Å –∑–∞–≥–∞–¥–∞–Ω–Ω—ã–º –º—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è


markup_start = types.ReplyKeyboardMarkup(resize_keyboard=True) # –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (resize_keyboard=True ‚Äî –ø–æ–¥ —á–∏—Å–ª–æ –∫–Ω–æ–ø–æ–∫)
markup_start.add(types.KeyboardButton("–∑–∞–≥–∞–¥–∞–π")) # –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *—Ç–µ–∫—Å—Ç* –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ

markup_give_a_hint = types.ReplyKeyboardMarkup(resize_keyboard=True) # –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (resize_keyboard=True ‚Äî –ø–æ–¥ —á–∏—Å–ª–æ –∫–Ω–æ–ø–æ–∫)
markup_give_a_hint.add(types.KeyboardButton("–ø–æ–¥—Å–∫–∞–∂–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")) # –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *—Ç–µ–∫—Å—Ç* –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ
markup_give_a_hint.add(types.KeyboardButton("–ø–æ–¥—Å–∫–∞–∂–∏ –≥–æ–¥")) # –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *—Ç–µ–∫—Å—Ç* –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ
markup_give_a_hint.add(types.KeyboardButton("–ø–æ–¥—Å–∫–∞–∂–∏ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞")) # –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *—Ç–µ–∫—Å—Ç* –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ
markup_give_a_hint.add(types.KeyboardButton("–ø–æ–¥—Å–∫–∞–∂–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∞–∫—Ç—ë—Ä–æ–≤")) # –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *—Ç–µ–∫—Å—Ç* –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ
markup_give_a_hint.add(types.KeyboardButton("–ø–æ–¥—Å–∫–∞–∂–∏ —Å–ª–æ–≥–∞–Ω")) # –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *—Ç–µ–∫—Å—Ç* –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ
markup_give_a_hint.add(types.KeyboardButton("–ø–æ–¥—Å–∫–∞–∂–∏ —á–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è")) # –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *—Ç–µ–∫—Å—Ç* –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ

@bot.message_handler(commands=['start']) # –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
def get_command(message):
    chosen_movie[message.chat.id] = None # –¥–µ–ª–∞–µ–º –ø—É—Å—Ç—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–º —Ñ–∏–ª—å–º–µ
    weights[message.chat.id] = np.ones(shape=(len(movies))) # –∑–∞–¥–∞—ë–º –≤–µ—Å–∞ (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏) —Ä–∞–≤–Ω–æ–∑–Ω–∞—á–Ω—ã–º–∏ (—Ä–∞–∑–º–µ—Ä–∞ len(movies))
    bot.send_message(chat_id=message.chat.id, text=f"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –≤–∞—Å –≤ –Ω–∞—à–µ–º —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–µ, –¥–∞ –Ω–∞—á–Ω—ë–º –∂–µ —É–≥–∞–¥—ã–≤–∞—Ç—å!", reply_markup=markup_start) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)

@bot.message_handler(commands=['help']) # –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
def get_command(message):
    bot.send_message(chat_id=message.chat.id, text=f"–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:\n\
1) '–∑–∞–≥–∞–¥–∞–π' ‚Äî –¥–ª—è –∑–∞–≥–∞–¥—ã–≤–∞–Ω–∏—è –º—É–ª—å—Ç—Ñ–∏–ª—å–º–∞\n\
2) '–ø–æ–¥—Å–∫–∞–∂–∏ *', –≥–¥–µ * —ç—Ç–æ —Å–ª–æ–≤–æ –∏–∑ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≥–æ–¥, —Ä–µ–∂–∏—Å—Å—ë—Ä–∞, –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∞–∫—Ç—ë—Ä–æ–≤, —Å–ª–æ–≥–∞–Ω, —á–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è) ‚Äî –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏\n\
3) '—Å–¥–∞—é—Å—å' ‚Äî —á—Ç–æ–±—ã –ø—Ä–∏–∑–Ω–∞—Ç—å –ø–æ—Ä–∞–∂–µ–Ω–∏–µüò° –∏ —É–∑–Ω–∞—Ç—å –∑–∞–≥–∞–¥–∞–Ω–Ω—ã–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º\n\
4) –Ω—É –∏ –∫–æ–Ω–µ—á–Ω–æ –∂–µ —Å–∞–º–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–∞, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω") # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) 

@bot.message_handler(content_types=['text']) # –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
def get_text(message):
    message_text = message.text.lower().strip() # –ø—Ä–∏–≤–æ–¥–∏–º –ø—Ä–∏—à–µ–¥—à–∏–π —Ç–µ–∫—Å—Ç –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –∏ —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

    if message.chat.id not in chosen_movie.keys(): # –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /start (–Ω–µ—Ç –∑–∞–ø–∏—Å–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ)
        chosen_movie[message.chat.id] = None # –¥–µ–ª–∞–µ–º –ø—É—Å—Ç—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–º —Ñ–∏–ª—å–º–µ
        weights[message.chat.id] = np.ones(shape=(len(movies))) # –∑–∞–¥–∞—ë–º –≤–µ—Å–∞ (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏) —Ä–∞–≤–Ω–æ–∑–Ω–∞—á–Ω—ã–º–∏ (—Ä–∞–∑–º–µ—Ä–∞ len(movies))

    if message_text == "–∑–∞–≥–∞–¥–∞–π":
        if chosen_movie[message.chat.id] is not None: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º —É–∂–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            bot.send_message(chat_id=message.chat.id, text=f"–í–∞–º —É–∂–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω –º—É–ª—å—Ç—Ñ–∏–ª—å–º, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '–ø–æ–¥—Å–∫–∞–∂–∏ *' (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≥–æ–¥, —Ä–µ–∂–∏—Å—Å—ë—Ä–∞, –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∞–∫—Ç—ë—Ä–æ–≤, —Å–ª–æ–≥–∞–Ω, —á–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è), —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –∏–ª–∏ '—Å–¥–∞—é—Å—å', —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∑–∞–≥–∞–¥–∞–Ω–Ω—ã–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º.", reply_markup=markup_give_a_hint)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
        else: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º –µ—â—ë –Ω–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            if weights[message.chat.id].sum() == 0: # –µ—Å–ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ñ–∏–ª—å–º–æ–≤ –∑–∞–Ω—É–ª–∏–ª–∏—Å—å –∏–∑-–∑–∞ –¥–æ–ª–≥–æ–π –∏–≥—Ä—ã
                weights[message.chat.id] = np.ones(shape=(len(movies))) # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

            movie_number = random.choices(np.arange(len(movies)), k=1, weights=weights[message.chat.id])[0] # —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –≤—ã–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä —Ñ–∏–ª—å–º–∞ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ—Å–æ–≤ weights)
            weights[message.chat.id][movie_number] = 0 # –∑–∞–Ω—É–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ —ç—Ç–æ–≥–æ –∂–µ —Ñ–∏–ª—å–º–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            chosen_movie[message.chat.id] = movies[movie_number] # –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –º—É–ª—å—Ç—Ñ–∏–ª—å–º –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

            bot.send_message(chat_id=message.chat.id, text=f"–ó–∞–≥–∞–¥–∞–ª... \n{''.join([e[0] for e in movies[movie_number]['emojis']])}") # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) 
            if len(movies[movie_number]["hint"]):
                bot.send_message(chat_id=message.chat.id, text=f"–ù–µ–±–æ–ª—å—à–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞, –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –µ—Å—Ç—å —Ü–∏—Ñ—Ä—ã: {' '.join(movies[movie_number]['hint'])}.") # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) 
            # bot.send_message(chat_id=message.chat.id, text=f"{chosen_movie[message.chat.id]['title']}") # DEBUG

    elif message_text == "—Å–¥–∞—é—Å—å":
        if chosen_movie[message.chat.id] is None: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º –µ—â—ë –Ω–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            bot.send_message(chat_id=message.chat.id, text=f"–£–∂–µ —Å–¥–∞—ë—à—å—Å—è?! –Ø –∂–µ –µ—â—ë –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥–∞–¥–∞–ª...", reply_markup=markup_start) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
        else: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º —É–∂–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            bot.send_message(chat_id=message.chat.id, text=f"–ë—ã–ª –∑–∞–≥–∞–¥–∞–Ω –º—É–ª—å—Ç—Ñ–∏–ª—å–º '{chosen_movie[message.chat.id]['title']}'.", reply_markup=markup_start) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
            chosen_movie[message.chat.id] = None # –æ—á–∏—â–∞–µ–º –∑–∞–ø–∏—Å—å –æ –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–º –º—É–ª—å—Ç—Ñ–∏–ª—å–º–µ

    elif message_text.find("–ø–æ–¥—Å–∫–∞–∂–∏") != -1:
        if chosen_movie[message.chat.id] is None: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º –µ—â—ë –Ω–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            bot.send_message(chat_id=message.chat.id, text=f"–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å '–∑–∞–≥–∞–¥–∞–π'!", reply_markup=markup_start) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
        else: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º —É–∂–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            if message_text == "–ø–æ–¥—Å–∫–∞–∂–∏": # –µ—Å–ª–∏ –Ω–µ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏
                bot.send_message(chat_id=message.chat.id, text=f"–Ø –º–æ–≥—É –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:", reply_markup=markup_give_a_hint) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
            if message_text.find("–∫–∞—Ç–µ–≥–æ—Ä–∏–∏") != -1:
                bot.send_message(chat_id=message.chat.id, text=f"–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: {', '.join(chosen_movie[message.chat.id]['categories'])}.", reply_markup=markup_give_a_hint)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
            if message_text.find("–≥–æ–¥") != -1:
                bot.send_message(chat_id=message.chat.id, text=f"–ì–æ–¥: {chosen_movie[message.chat.id]['year']}.", reply_markup=markup_give_a_hint)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
            if message_text.find("—Ä–µ–∂–∏—Å—Å—ë—Ä–∞") != -1:
                bot.send_message(chat_id=message.chat.id, text=f"–†–µ–∂–∏—Å—Å—ë—Ä—ã: {', '.join(chosen_movie[message.chat.id]['directors'])}.", reply_markup=markup_give_a_hint)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
            if message_text.find("–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∞–∫—Ç—ë—Ä–æ–≤") != -1:
                bot.send_message(chat_id=message.chat.id, text=f"–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –∞–∫—Ç—ë—Ä—ã: {', '.join(chosen_movie[message.chat.id]['actors'])}.", reply_markup=markup_give_a_hint)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
            if message_text.find("—Å–ª–æ–≥–∞–Ω") != -1:
                bot.send_message(chat_id=message.chat.id, text=f"–°–ª–æ–≥–∞–Ω: {chosen_movie[message.chat.id]['tagline']}.", reply_markup=markup_give_a_hint)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
            if message_text.find("—á–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è") != -1:
                start = random.randrange(len(chosen_movie[message.chat.id]["title"])) # —Å–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä, —Å –∫–∞–∫–æ–π –±—É–∫–≤—ã –≤—ã–≤–µ–¥–µ–º –æ—Ç–≤–µ—Ç 
                end = random.randrange(len(chosen_movie[message.chat.id]["title"])) # —Å–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä, –ø–æ –∫–∞–∫—É—é –±—É–∫–≤—É –≤—ã–≤–µ–¥–µ–º –æ—Ç–≤–µ—Ç 
                start, end = min(start, end), max(start, end) # —Å–æ—Ä—Ç–∏—Ä—É–µ–º, —á—Ç–æ–±—ã end –Ω–µ –±—ã–ª —Ä–∞–Ω—å—à–µ —Å—Ç–∞—Ä—Ç–∞
                hint = "" # –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ —á–∞—Å—Ç–∏ —Å–ª–æ–≤–∞
                for i in range(len(chosen_movie[message.chat.id]["title"])): # –∏–¥—ë–º –ø–æ —á–∏—Å–ª—É –±—É–∫–≤ –≤ –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–º –Ω–∞–∑–≤–∞–Ω–∏–∏
                    if start <= i <= end: # –µ—Å–ª–∏ –±—É–∫–≤–∞ –≤ –Ω—É–∂–Ω–æ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ
                        hint += chosen_movie[message.chat.id]["title"][i] # –¥–æ–±–∞–≤–ª—è–µ–º –µ—ë —Å–∞–º—É
                    else: # –∏–Ω–∞—á–µ
                        hint += "*" # –∑–∞—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º –±—É–∫–≤—É
                bot.send_message(chat_id=message.chat.id, text=f"–ß–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è: '{hint}'.", reply_markup=markup_give_a_hint) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)

    else: # –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
        if chosen_movie[message.chat.id] is None: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º –µ—â—ë –Ω–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            bot.send_message(chat_id=message.chat.id, text=f"–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –∑–∞–≥–∞–¥–∞—Ç—å –º—É–ª—å—Ç—Ñ–∏–ª—å–º, –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç–ø—Ä–∞–≤—å '–∑–∞–≥–∞–¥–∞–π'!", reply_markup=markup_start)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
        else: # –µ—Å–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º —É–∂–µ –±—ã–ª –∑–∞–≥–∞–¥–∞–Ω
            pred = re.sub(r"[ ,.‚Ä¶?!:;/@#$#\-‚Äî„ÉÑ‚ñ∫‡πë€©€û€©‚Ä¢*‚ÄùÀúÀú‚Äù*¬∞¬∞*`'‚Äú\"()\\]", '', message_text) # —É–¥–∞–ª—è–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
            true = chosen_movie[message.chat.id]["title"].lower().strip() # –ø—Ä–∏–≤–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –∏ —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
            true = re.sub(r"[ ,.‚Ä¶?!:;/@#$#\-‚Äî„ÉÑ‚ñ∫‡πë€©€û€©‚Ä¢*‚ÄùÀúÀú‚Äù*¬∞¬∞*`'‚Äú\"()\\]", '', true) # —É–¥–∞–ª—è–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–∑ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è

            if pred == true: # –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç —Å–æ–≤–ø–∞–ª 
                bot.send_message(chat_id=message.chat.id, text=f"–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –í—ã —É–≥–∞–¥–∞–ª–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º '{chosen_movie[message.chat.id]['title']}'!", reply_markup=markup_start)  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
                chosen_movie[message.chat.id] = None # –æ—á–∏—â–∞–µ–º –∑–∞–ø–∏—Å—å –æ –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–º –º—É–ª—å—Ç—Ñ–∏–ª—å–º–µ
            else: # –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–ª
                correct_letters = 0 # —á–∏—Å–ª–æ —Å–æ–≤–ø–∞–≤—à–∏—Ö –±—É–∫–≤
                for i in range(min(len(pred), len(true))): # –∏–¥—ë–º –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω–µ
                    if pred[i] == true[i]: # —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –±—É–∫–≤—ã –Ω–∞ –ø–æ–∑–∏—Ü–∏—è—Ö
                        correct_letters += 1 # —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —á–∏—Å–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                bot.send_message(chat_id=message.chat.id, text=f"–ë—É–∫–≤ —Å–æ–≤–ø–∞–ª–æ {correct_letters}. –ü–æ–ø—ã—Ç–∞–π—Å—è –µ—â—ë —Ä–∞–∑!")  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (text) –≤ —á–∞—Ç (chat_id) —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply_markup)
        
while True: # –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª, —Ç–∞–∫ –∫–∞–∫ telebot –º–æ–∂–µ—Ç –æ–±–æ—Ä–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ 
    try: # –ø—ã—Ç–∞–µ–º—Å—è
        bot.polling(none_stop=True, interval=0) # –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π (none_stop=True –Ω–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç –±–æ—Ç–∞ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ ApiException) —Ü–∏–∫–ª –æ–±—Ä–∞—â–µ–Ω–∏–π (—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –≤ interval=0) –±–æ—Ç–∞ –∫ —Ç–µ–ª–µ–≥—Ä–∞–º —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

    except Exception as e: # –ª–æ–≤–∏–º –æ—à–∏–±–∫—É
        print("Looks like we got a telebot exception:", e) # –≤—ã–≤–æ–¥–∏ –æ—à–∏–±–∫—É
        time.sleep(10) # –∂–¥—ë–º 10 —Å–µ–∫—É–Ω–¥ –∏ —Å–Ω–æ–≤–∞ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –±–æ—Ç—É
